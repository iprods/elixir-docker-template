# Set up the Mutagen service and code volume before creating sessions.
beforeCreate:
  - docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml up --build --detach mutagen

# Set up the main services after creating sessions. At this point, sessions will
# have been established and code pushed to the shared volume.
afterCreate:
  - docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml up --build --detach

# Pause services after pausing sessions.
afterPause:
  - docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml stop

# Resume services before resume sessions.
beforeResume:
  - docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml start

# Tear down all services and remove the code volume after terminating sessions.
afterTerminate:
  - docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml down

commands:
  docker-compose: docker-compose -f docker-compose.yml -f docker-compose.mutagen.yml

# Synchronize code to the shared Docker volume via the Mutagen service.
sync:
  defaults:
    flushOnCreate: true
    ignore:
      vcs: true
  code:
    alpha: "."
    beta: "docker://template-mutagen/app"
    mode: "two-way-safe"
